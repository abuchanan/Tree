<!doctype html>
<html
<head>
  <meta charset='utf-8'>
</head>
<body>

<script src='three.js'></script>
<script>

var scene = new THREE.Scene();

var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.y = 100;
camera.position.z = 200;

var renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);

document.body.appendChild(renderer.domElement);

var leaf_material = new THREE.MeshLambertMaterial({color: 'green'});
var wood_material = new THREE.MeshLambertMaterial({color: 'gray'})

var tree = new THREE.Object3D();
scene.add(tree);

// Create the trunk

var trunk_height = 200;

var trunk = new THREE.Mesh(new THREE.CylinderGeometry(1, 5, trunk_height, 5, 20, true), wood_material);
trunk.position.y = trunk_height / 2;
tree.add(trunk);

// Add branches

var min_branch_length = 25;
var max_branch_length = 75;
var branch_base_height = 25;
var branch_spacing = 10;
var branch_rotation_offset = Math.PI * .25;
var min_branch_angle = 0.1;
var max_branch_angle = 0.35;

for (var branch_height = branch_base_height, offset = false; branch_height < trunk_height; branch_height += branch_spacing, offset = !offset) {

  // branch length is a function of branch position
  var z = branch_height / (trunk_height - branch_base_height);
  var branch_length = ((1 - z) * (max_branch_length - min_branch_length)) + min_branch_length;
  var branch_angle = (z * (max_branch_angle - min_branch_angle)) + min_branch_angle;

  for (var i = 0; i < 4; i++) {

    var branch = new THREE.Object3D();

    var b_geo = new THREE.CubeGeometry(branch_length, 1, 1);
    b_geo.applyMatrix(new THREE.Matrix4().makeTranslation(branch_length / 2, 0, 0));

    var b = new THREE.Mesh(b_geo, wood_material);

    branch.add(b);

    branch.position.y = branch_height;
    branch.rotation.y = Math.PI * 0.5 * i;
    if (offset) {
      branch.rotation.y += branch_rotation_offset;
    }

    branch.rotation.z = Math.PI * branch_angle;

    tree.add(branch);

    // Add leaves

    var leaf_start = 10;
    var leaf_spacing = 2;
    var max_leaf_length = 10;
    var min_leaf_length = 3;
    var leaf_rotation = 0.4;

    for (var leaf_position = leaf_start; leaf_position < branch_length; leaf_position += leaf_spacing) {

      var p = 1 - ((leaf_position - leaf_start) / (branch_length - leaf_start));
      var leaf_length = ((max_leaf_length - min_leaf_length) * p) + min_leaf_length;

      var leaf_geo = new THREE.CubeGeometry(leaf_length, 0.5, 0.5);
      leaf_geo.applyMatrix(new THREE.Matrix4().makeTranslation(leaf_length / 2, 0, 0));

      var c = new THREE.Mesh(leaf_geo, leaf_material);
      c.rotation.y = .5;
      c.position.x = leaf_position;
      c.rotation.x = Math.PI * ((Math.random() * 0.3) - 0.15);

      branch.add(c);

      var d = new THREE.Mesh(leaf_geo, leaf_material);
      d.rotation.y = -.5;
      d.position.x = leaf_position;
      d.rotation.x = Math.PI * ((Math.random() * leaf_rotation) - (leaf_rotation / 2));

      branch.add(d);
    }
  }
}


var axes = new THREE.AxisHelper(50);
axes.position.x = -100;
scene.add(axes);



var l = new THREE.PointLight(0xFFFFFF);
l.position.set(0, 0, 150);
scene.add(l);

//var ambientLight = new THREE.AmbientLight(0x000044);
//scene.add(ambientLight);



function render() {
  requestAnimationFrame(render);
  tree.rotation.y += 0.02;
  renderer.render(scene, camera);

}
//render();

tree.rotation.y = Math.PI * 0.4;
renderer.render(scene, camera);
</script>
</body>
</html>
